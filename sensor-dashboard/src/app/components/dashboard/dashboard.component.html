<div class="container-fluid" *ngIf="!isLoading; else loadingTemplate">
  <!-- Performance Metrics Row -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card metric-card">
        <div class="card-body text-center">
          <div class="metric-value text-primary">{{ totalReadings | number }}</div>
          <div class="metric-label">Total Readings</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card metric-card">
        <div class="card-body text-center">
          <div class="metric-value text-success">{{ readingsPerSecond | number }}</div>
          <div class="metric-label">Readings/Sec</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card metric-card">
        <div class="card-body text-center">
          <div class="metric-value text-info">{{ formatBytes(memoryUsage) }}</div>
          <div class="metric-label">Memory Usage</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card metric-card">
        <div class="card-body text-center">
          <div class="metric-value text-warning">{{ formatUptime(uptime) }}</div>
          <div class="metric-label">Uptime</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Controls -->
  <div class="row mb-3">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-filter me-2"></i>
            Sensor Type Filter
          </h5>
        </div>
        <div class="card-body">
          <div class="btn-group flex-wrap" role="group">
            <button type="button" 
                    class="btn btn-outline-primary"
                    [class.active]="selectedSensorType === null"
                    (click)="filterBySensorType(null)">
              <i class="fas fa-globe me-1"></i>
              All Sensors
            </button>
            <button type="button" 
                    *ngFor="let type of [0,1,2,3,4,5,6]"
                    class="btn btn-outline-primary"
                    [class.active]="selectedSensorType === type"
                    (click)="filterBySensorType(type)">
              <i [class]="getSensorTypeIcon(type)" class="me-1"></i>
              {{ getSensorTypeName(type) }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Row -->
  <div class="row">
    <!-- Real-time Chart -->
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-chart-line me-2"></i>
            Real-time Sensor Data
            <span class="badge bg-success ms-2 real-time-indicator">LIVE</span>
          </h5>
        </div>
        <div class="card-body">
          <app-sensor-chart [chartData]="chartData" [height]="400"></app-sensor-chart>
        </div>
      </div>
    </div>

    <!-- Alerts Panel -->
    <div class="col-lg-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-exclamation-triangle me-2"></i>
            Recent Alerts
            <span class="badge bg-danger ms-2">{{ alerts.length }}</span>
          </h5>
        </div>
        <div class="card-body" style="max-height: 400px; overflow-y: auto;">
          <app-alerts [alerts]="alerts"></app-alerts>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics and Recent Readings Row -->
  <div class="row mt-4">
    <!-- Statistics -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-chart-bar me-2"></i>
            Sensor Statistics
          </h5>
        </div>
        <div class="card-body">
          <app-statistics [statistics]="getFilteredStatistics()"></app-statistics>
        </div>
      </div>
    </div>

    <!-- Recent Readings -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-list me-2"></i>
            Recent Readings
            <span class="badge bg-info ms-2">{{ getFilteredReadings().length }}</span>
          </h5>
        </div>
        <div class="card-body" style="max-height: 400px; overflow-y: auto;">
          <div class="table-responsive">
            <table class="table table-sm table-hover">
              <thead>
                <tr>
                  <th>Sensor</th>
                  <th>Type</th>
                  <th>Value</th>
                  <th>Time</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let reading of getFilteredReadings(); trackBy: trackByReading">
                  <td>
                    <small class="text-muted">{{ reading.sensorId }}</small>
                  </td>
                  <td>
                    <i [class]="getSensorTypeIcon(reading.type)" class="me-1"></i>
                    <small>{{ getSensorTypeName(reading.type) }}</small>
                  </td>
                  <td>
                    <strong>{{ reading.value | number:'1.2-2' }}</strong>
                    <small class="text-muted">{{ reading.unit }}</small>
                  </td>
                  <td>
                    <small class="text-muted">{{ reading.timestamp | date:'HH:mm:ss' }}</small>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #loadingTemplate>
  <div class="loading-spinner">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <div class="ms-3">
      <h5>Loading Dashboard...</h5>
      <p class="text-muted">Connecting to sensor data stream</p>
    </div>
  </div>
</ng-template>
